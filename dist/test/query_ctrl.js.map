{"version":3,"sources":["../../src/query_ctrl.js"],"names":["PNPDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","scope","target","host","datasource","DEFAULT_HOST","service","DEFAULT_SERVICE","perflabel","DEFAULT_PERFLABEL","type","fill","factor","metricFindData","then","transformToSegments","panelCtrl","refresh","QueryCtrl","templateUrl"],"mappings":";;;;;;;;;AAAA;;AACA;;;;;;;;IAEaA,sB,WAAAA,sB;;;AAEX,kCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,YAA/B,EAA8C;AAAA;;AAAA,gJACtCF,MADsC,EAC9BC,SAD8B;;AAG5C,UAAKE,KAAL,GAAaH,MAAb;AACA,UAAKE,YAAL,GAAwBA,YAAxB;AACA,UAAKE,MAAL,CAAYC,IAAZ,GAAwB,MAAKD,MAAL,CAAYC,IAAZ,IAAyB,MAAKC,UAAL,CAAgBC,YAAjE;AACA,UAAKH,MAAL,CAAYI,OAAZ,GAAwB,MAAKJ,MAAL,CAAYI,OAAZ,IAAyB,MAAKF,UAAL,CAAgBG,eAAjE;AACA,UAAKL,MAAL,CAAYM,SAAZ,GAAwB,MAAKN,MAAL,CAAYM,SAAZ,IAAyB,MAAKJ,UAAL,CAAgBK,iBAAjE;AACA,UAAKP,MAAL,CAAYQ,IAAZ,GAAwB,MAAKR,MAAL,CAAYQ,IAAZ,IAAyB,SAAjD;AACA,UAAKR,MAAL,CAAYS,IAAZ,GAAwB,MAAKT,MAAL,CAAYS,IAAZ,IAAyB,MAAjD;AACA,UAAKT,MAAL,CAAYU,MAAZ,GAAwB,MAAKV,MAAL,CAAYU,MAAZ,IAAyB,EAAjD;AAV4C;AAW7C;;;;8BAES;AACR,aAAO,KAAKR,UAAL,CAAgBS,cAAhB,CAA+B,MAA/B,EAAuC,KAAKX,MAA5C,EAAoD,IAApD,EACJY,IADI,CACC,KAAKd,YAAL,CAAkBe,mBAAlB,CAAsC,KAAtC,CADD,CAAP;AAED;;;iCAEY;AACX,aAAO,KAAKX,UAAL,CAAgBS,cAAhB,CAA+B,SAA/B,EAA0C,KAAKX,MAA/C,EAAuD,IAAvD,EACJY,IADI,CACC,KAAKd,YAAL,CAAkBe,mBAAlB,CAAsC,KAAtC,CADD,CAAP;AAED;;;mCAEc;AACb,aAAO,KAAKX,UAAL,CAAgBS,cAAhB,CAA+B,WAA/B,EAA4C,KAAKX,MAAjD,EAAyD,IAAzD,EACJY,IADI,CACC,KAAKd,YAAL,CAAkBe,mBAAlB,CAAsC,KAAtC,CADD,CAAP;AAED;;;uCAEkB;AACjB,WAAKC,SAAL,CAAeC,OAAf;AACD;;;uCAEkB;AACjB,UAAG,KAAKf,MAAL,CAAYM,SAAZ,IAAyB,KAAKJ,UAAL,CAAgBK,iBAAzC,IACA,KAAKP,MAAL,CAAYC,IAAZ,IAAyB,KAAKC,UAAL,CAAgBC,YADzC,IAEA,KAAKH,MAAL,CAAYI,OAAZ,IAAyB,KAAKF,UAAL,CAAgBG,eAF5C,EAE6D;AACzD,eAAO,qBAAP;AACH;AACD,aAAO,KAAKL,MAAL,CAAYM,SAAZ,GACC,IADD,GACM,KAAKN,MAAL,CAAYC,IADlB,GAEC,KAFD,GAEO,KAAKD,MAAL,CAAYI,OAF1B;AAID;;;;EA5CyCY,c;;AA+C5CrB,uBAAuBsB,WAAvB,GAAqC,4BAArC","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class PNPDatasourceQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv)  {\n    super($scope, $injector);\n\n    this.scope = $scope;\n    this.uiSegmentSrv     = uiSegmentSrv;\n    this.target.host      = this.target.host      || this.datasource.DEFAULT_HOST;\n    this.target.service   = this.target.service   || this.datasource.DEFAULT_SERVICE;\n    this.target.perflabel = this.target.perflabel || this.datasource.DEFAULT_PERFLABEL;\n    this.target.type      = this.target.type      || 'AVERAGE';\n    this.target.fill      = this.target.fill      || 'fill';\n    this.target.factor    = this.target.factor    || '';\n  }\n\n  getHost() {\n    return this.datasource.metricFindData(\"host\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getService() {\n    return this.datasource.metricFindData(\"service\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getPerflabel() {\n    return this.datasource.metricFindData(\"perflabel\", this.target, true)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  onChangeInternal() {\n    this.panelCtrl.refresh();\n  }\n\n  getCollapsedText() {\n    if(this.target.perflabel == this.datasource.DEFAULT_PERFLABEL &&\n       this.target.host      == this.datasource.DEFAULT_HOST &&\n       this.target.service   == this.datasource.DEFAULT_SERVICE) {\n        return(\"click to edit query\");\n    }\n    return(this.target.perflabel\n           +': '+this.target.host\n           +' - '+this.target.service\n           );\n  }\n}\n\nPNPDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}